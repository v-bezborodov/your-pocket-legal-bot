import { Markup } from "telegraf";
import { BACK_MENU, TALK_TO_BOT_MENU } from "../../domain/constants/menuOptions.js";
import { showMainMenu } from "./menuHandlers.ts";

const instructions = {
  street: `üö∂‚Äç‚ôÇÔ∏è –Ø–∫—â–æ –≤–∞—Å –∑—É–ø–∏–Ω–∏–ª–∏ –Ω–∞ –≤—É–ª–∏—Ü—ñ:
1Ô∏è‚É£ –ó–±–µ—Ä—ñ–≥–∞–π—Ç–µ —Å–ø–æ–∫—ñ–π.
2Ô∏è‚É£ –ó–∞–ø–∏—Ç–∞–π—Ç–µ –ø—ñ–¥—Å—Ç–∞–≤—É –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏.
3Ô∏è‚É£ –ú–∞—î—Ç–µ –ø—Ä–∞–≤–æ –Ω–µ –ø–æ–∫–∞–∑—É–≤–∞—Ç–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏ –±–µ–∑ –ø—Ä–∏—á–∏–Ω–∏.
4Ô∏è‚É£ –ú–æ–∂–µ—Ç–µ —Ñ—ñ–∫—Å—É–≤–∞—Ç–∏ –¥—ñ—ó –ø–æ–ª—ñ—Ü—ñ—ó –Ω–∞ –≤—ñ–¥–µ–æ.`,
  car: `üöó –Ø–∫—â–æ –≤–∞—Å –∑—É–ø–∏–Ω–∏–ª–∏ –≤ –∞–≤—Ç–æ–º–æ–±—ñ–ª—ñ:
1Ô∏è‚É£ –í–≤—ñ–º–∫–Ω—ñ—Ç—å –∞–≤–∞—Ä—ñ–π–∫—É —Ç–∞ –Ω–µ –≤–∏—Ö–æ–¥—å—Ç–µ –∑ –∞–≤—Ç–æ.
2Ô∏è‚É£ –í–∏–º–∞–≥–∞–π—Ç–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–∏—Å—å —Ç–∞ –ø–æ—è—Å–Ω–∏—Ç–∏ –ø—Ä–∏—á–∏–Ω—É.
3Ô∏è‚É£ –ù–µ –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∏ —á–µ—Ä–µ–∑ –≤—ñ–∫–Ω–æ.
4Ô∏è‚É£ –ú–∞—î—Ç–µ –ø—Ä–∞–≤–æ –≤–µ—Å—Ç–∏ –≤—ñ–¥–µ–æ–∑–∞–ø–∏—Å.`,
  home: `üè† –Ø–∫—â–æ —É –≤–∞—Å –æ–±—à—É–∫:
1Ô∏è‚É£ –í–∏–º–∞–≥–∞–π—Ç–µ —É—Ö–≤–∞–ª—É —Å—É–¥—É.
2Ô∏è‚É£ –ü–æ–ø—Ä–æ—Å—ñ—Ç—å –∞–¥–≤–æ–∫–∞—Ç–∞.
3Ô∏è‚É£ –ó–Ω—ñ–º–∞–π—Ç–µ –≤—ñ–¥–µ–æ, —è–∫—â–æ –º–æ–∂–ª–∏–≤–æ.
4Ô∏è‚É£ –ù–µ –ø—ñ–¥–ø–∏—Å—É–π—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∏, –Ω–µ –ø—Ä–æ—á–∏—Ç–∞–≤—à–∏.`,
  other: `‚öñÔ∏è –û–ø–∏—à—ñ—Ç—å –≤–∞—à—É —Å–∏—Ç—É–∞—Ü—ñ—é –∫–æ—Ä–æ—Ç–∫–æ, —ñ —è –¥–æ–ø–æ–º–æ–∂—É —Ä–æ–∑—ñ–±—Ä–∞—Ç–∏—Å—å.`,
  chat: `‚öñÔ∏è –û–ø–∏—à—ñ—Ç—å –≤–∞—à—É —Å–∏—Ç—É–∞—Ü—ñ—é —è–∫–æ–º–æ–≥–∞ –¥–µ—Ç–∞–ª—å–Ω—ñ—à–µ, —ñ —è –¥–æ–ø–æ–º–æ–∂—É —Ä–æ–∑—ñ–±—Ä–∞—Ç–∏—Å—å.`,
};

export async function handleFlow(ctx, type) {
  await ctx.reply(instructions[type], Markup.keyboard([...BACK_MENU, ...TALK_TO_BOT_MENU]).resize());

  // Save user state (simple local map; can move to DB later)
  ctx.session ??= {};
  ctx.session.step = type;
}

export async function handleChat(ctx, type) {

  await ctx.reply(instructions[type], Markup.keyboard(BACK_MENU).resize());

  ctx.session ??= {};
  ctx.session.step = type;
}

export async function handleBackOrRestart(ctx) {
  const text = ctx.message.text;
  if (text === 'üîô –ù–∞–∑–∞–¥') {
    await showMainMenu(ctx);
    ctx.session.step = null;
  }
}
